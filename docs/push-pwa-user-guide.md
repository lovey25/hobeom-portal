# 백그라운드 알림 & PWA 사용자 가이드

호범 포털에서 백그라운드 알림을 받고 PWA로 설치하는 방법을 안내합니다.

## 📱 백그라운드 푸시 알림이란?

브라우저 탭이 닫혀있어도 알림을 받을 수 있는 기능입니다.

### 알림 종류

1. **할일 리마인더** - 설정한 시간에 오늘의 할일 확인 유도
2. **여행 준비 알림** - 여행 D-day 기준 N일 전부터 준비물 확인 알림

### 일반 웹 vs 백그라운드 알림

```
일반 웹 (브라우저 Notification API):
❌ 탭이 열려있어야만 알림 수신
❌ 브라우저 꺼지면 알림 못 받음

백그라운드 알림 (Web Push API):
✅ 탭 닫혀있어도 알림 수신
✅ 브라우저만 실행 중이면 OK
✅ PWA 설치 시 브라우저 꺼져도 수신 (모바일)
```

## 🔔 백그라운드 알림 설정 방법

### 1단계: 브라우저 알림 권한 허용

1. 호범 포털 로그인
2. **설정** → **알림 탭**
3. "브라우저 알림 권한" 섹션에서 **"알림 권한 허용하기"** 클릭
4. 브라우저 팝업에서 **"허용"** 클릭

### 2단계: 푸시 알림 구독

1. "백그라운드 푸시 알림" 섹션으로 이동
2. **"푸시 알림 구독하기"** 버튼 클릭
3. 구독 완료 시 녹색 박스로 변경 (현재 디바이스 정보 표시)

### 3단계: 테스트 푸시

1. **"테스트 푸시 보내기"** 버튼 클릭
2. 즉시 알림이 표시되는지 확인

### 4단계: 백그라운드 테스트

1. 브라우저 탭 닫기
2. 백그라운드 스케줄러가 알림 조건 체크 (매 분마다)
3. 조건 충족 시 알림 수신

## 📱 PWA (앱) 설치

### PWA 설치의 장점

```
일반 브라우저 사용:
❌ 브라우저 완전히 닫으면 알림 받을 수 없음 (데스크톱)
❌ 매번 주소 입력 필요

PWA 설치 후:
✅ 브라우저 꺼져도 백그라운드 알림 수신 (모바일)
✅ 앱 아이콘 클릭으로 바로 실행
✅ 독립된 창에서 실행
✅ 오프라인 기본 기능 사용
✅ 더 빠른 로딩
```

### 플랫폼별 설치 방법

#### Android (Chrome/Edge)

**방법 1: 설정 페이지에서 설치 (권장)**

1. 설정 → 알림 탭
2. **🚀 앱으로 설치하기** 버튼 클릭
3. "설치" 확인

**방법 2: 브라우저 메뉴**

1. 메뉴(⋮) → **"앱 설치"**
2. "설치" 확인

**방법 3: 주소창 아이콘**

1. 주소창 오른쪽 **⊕** 아이콘 클릭
2. "설치" 확인

#### iOS/iPadOS (Safari)

⚠️ **Safari에서만 가능** (Chrome/Edge 불가)

1. 공유 버튼(↑) 클릭
2. **"홈 화면에 추가"** 선택
3. "추가" 확인

#### Windows (Chrome/Edge)

1. 주소창 오른쪽 설치 아이콘(⊕) 클릭
2. "설치" 확인
3. 시작 메뉴와 바탕화면에 추가됨

#### macOS

**Chrome/Edge**

1. 주소창 설치 아이콘 클릭
2. "설치" 확인
3. Dock에 추가됨

**Safari**

1. 파일 → Dock에 추가
2. 또는 공유 → Dock에 추가

## 🔧 다중 디바이스 관리

한 계정으로 여러 디바이스에서 구독할 수 있습니다.

### 현재 디바이스 확인

설정 → 알림 탭에서 현재 디바이스 정보 확인:

- 디바이스 이름 (예: Chrome on Windows)
- 디바이스 타입 (데스크톱/모바일)
- 브라우저 및 OS
- 구독 일시

### 다른 디바이스 확인

"다른 디바이스" 섹션에서 다른 구독 디바이스 목록 확인:

- 각 디바이스별 정보 표시
- 개별 디바이스 구독 해제 가능

### 디바이스 구독 해제

**현재 디바이스**

1. "푸시 알림 구독 해제" 버튼 클릭
2. 확인

**다른 디바이스 (원격 해제)**

1. "다른 디바이스" 목록에서 제거할 디바이스 찾기
2. "제거" 버튼 클릭
3. 확인

## 🚨 문제 해결

### 알림이 오지 않아요

**1. 브라우저 알림 권한 확인**

- 브라우저 설정 → 사이트 권한 → 알림
- 호범 포털이 "허용"으로 설정되어 있는지 확인

**2. 푸시 구독 상태 확인**

- 설정 → 알림 탭
- 구독 상태가 녹색 박스로 표시되는지 확인
- 아니면 다시 구독

**3. 테스트 푸시 전송**

- "테스트 푸시 보내기" 버튼으로 즉시 테스트
- 테스트도 안 오면 브라우저 재시작

**4. PWA 설치 (모바일)**

- 모바일에서 브라우저 완전히 닫았을 때도 알림 받으려면 PWA 설치 필수

### PWA 설치 버튼이 안 보여요

**조건 충족 확인:**

- ✅ HTTPS 연결 (localhost는 예외)
- ✅ manifest.json 파일 존재
- ✅ Service Worker 등록
- ✅ 아이콘 파일 (192x192, 512x512)
- ✅ 최소 사용 시간 (브라우저마다 다름)

**브라우저별 차이:**

- **Chrome/Edge**: 대부분 즉시 표시
- **Safari (iOS)**: 자동 설치 프롬프트 없음 (수동 설치만)
- **Firefox**: 주소창 아이콘 클릭

**수동 설치:**

- 플랫폼별 설치 방법 참고 (위 섹션)

### 구독이 풀렸어요

**원인:**

- 브라우저 데이터/쿠키 삭제
- 브라우저 재설치
- Service Worker 제거

**해결:**

- 설정 → 알림 탭
- "푸시 알림 구독하기" 다시 클릭

### 여러 디바이스에서 중복 알림

이것은 정상입니다:

- 구독된 모든 디바이스에 알림 전송
- 특정 디바이스만 사용하려면 다른 디바이스 구독 해제

## 📊 브라우저별 지원 현황

| 브라우저          | 데스크톱 푸시 | 모바일 푸시 | PWA 설치  |
| ----------------- | ------------- | ----------- | --------- |
| Chrome (Android)  | ✅            | ✅          | ✅        |
| Chrome (Windows)  | ✅            | -           | ✅        |
| Chrome (macOS)    | ✅            | -           | ✅        |
| Safari (iOS)      | -             | ⚠️ PWA만    | ✅ 수동   |
| Safari (macOS)    | ✅            | -           | ✅        |
| Edge (Windows)    | ✅            | -           | ✅        |
| Edge (Android)    | ✅            | ✅          | ✅        |
| Firefox (Windows) | ✅            | -           | ⚠️ 제한적 |
| Samsung Internet  | -             | ✅          | ✅        |

⚠️ = 제한적 지원

## 🔗 관련 문서

- **개발자 문서**: `/src/app/dashboard/settings/README.md` - 기술 구현 상세
- **관리자 도구**: `/src/app/dashboard/admin/push-test/README.md` - 푸시 테스트 기능
- **아키텍처**: `/docs/architecture.md` - 전체 시스템 구조
